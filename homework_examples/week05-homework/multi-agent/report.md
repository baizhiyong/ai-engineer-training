### **多代理协作写作系统（Multi-Agent）实验结果分析报告**

**摘要**

本项目成功设计并实现了一个基于多代理协作的文章写作系统。该系统利用 LangGraph 框架对四个专业化代理（研究、撰写、审核、润色）进行流程编排，并通过一个独立的 MCP (Model Context Protocol) 服务器为代理提供搜索和提示词管理等核心服务。实验结果表明，该架构能够稳定、高效地完成从接收用户主题到生成最终稿件的全过程，验证了 LangGraph 在多代理协作流程控制中的有效性，以及 MCP 在服务解耦和工具提供方面的优势。

---

#### **1. 系统设计与实现**

系统核心架构分为两大部分：**LangGraph 客户端** 和 **MCP 服务器**。

* **1.1. LangGraph 客户端**:
  
  - **代理角色**:
    
    1. **研究代理 (Research Agent)**: 调用 MCP 服务器的 `search` 工具，收集信息并生成结构化研究报告。
    2. **撰写代理 (Writing Agent)**: 基于研究报告，撰写文章初稿。
    3. **审核代理 (Review Agent)**: 检查初稿的内容质量和逻辑，并提供修改建议。
    4. **润色代理 (Polishing Agent)**: 结合初稿和修改建议，生成最终稿件。
  
  - **流程编排**: 使用 `LangGraph` 将上述四个代理定义为图中的节点（Node），并设定了 `研究 -> 撰写 -> 审核 -> 润色` 的线性执行路径（Edge）。`AgentState` 在节点间传递，确保了信息的完整性和一致性。
  
  - **模型**: 所有代理的功能均由通义千问的 `qwen-plus` 模型实现。

* **1.2. MCP 服务器**:
  
  - **功能**:
    
    1. **工具提供**: 暴露 `search` 工具，底层使用 `duckduckgo-search` 实现网络搜索。
    2. **配置管理**: 暴露 `get_prompt` 工具，为不同代理提供专属的系统提示词（System Prompt）。
  
  - **实现**: 使用 `fastmcp` 库实现，并通过 `streamable_http` 传输模式将其包装成一个独立的 服务。这种设计将工具和配置与代理的核心逻辑完全解耦。

---

#### **2. 实验过程**

实验按照严格分离的客户端/服务器模式进行：

1. **启动服务器**: 在一个终端中运行 `python -m multi-agent.mcp_server.main`，启动 MCP HTTP 服务器。服务器日志显示其在 `http://localhost:8000/mcp` 上成功监听。
2. **启动客户端**: 在另一个终端中运行 `python -m multi-agent.main`，启动 LangGraph 客户端应用。
3. **交互与执行**: 客户端成功连接到服务器后，提示用户输入文章主题。输入主题后，LangGraph 开始执行工作流。终端实时打印出当前执行的节点（例如 `--- 节点: 研究 ---`），清晰地展示了任务在不同代理间的流转过程。
4. **任务完成**: 所有节点执行完毕后，程序在项目根目录生成一个 Markdown 文件（`article_output_*.md`）。

---

#### **3. 结果分析**

* **3.1. 输出质量**:
  - **最终文章**: 从 `article_output_20250926_144236.md` 文件可以看出，系统能够生成一篇结构完整、内容相关、语言流畅的最终文章，符合预期目标。
  - **过程记录**: 生成的报告不仅包含最终稿件，还完整记录了每个代理的输出（研究报告、初稿、审核建议）。这为分析和调试各环节提供了极大的便利，透明度高。例如，研究代理输出了条理清晰的结构化报告，撰写代理基于此生成了高质量初稿，审核代理也给出了“文章质量很高，无需修改”的正确判断。
* **3.2. 架构有效性分析**:
  - **LangGraph 的优势**: LangGraph 在本次实验中表现出色。它将复杂的多代理协作流程转化为一个清晰、可控的状态图。相比于简单的链式调用（Chains），LangGraph 提供了更强的鲁棒性和灵活性，未来可以轻松地加入条件判断（例如，如果审核不通过则返回重写）和循环等复杂逻辑。
  - **MCP 服务器解耦的价值**: 将工具（搜索）和配置（提示词）放入独立的 MCP 服务器是本次架构设计的亮点。
    - **模块化**: 代理逻辑（`langgraph_app`）和外部服务（`mcp_server`）完全分离。未来可以独立升级或替换搜索工具（如换成 Google Search API），而无需修改任何代理代码。
    - **可扩展性**: 可以轻松地在 MCP 服务器上添加更多工具（如数据库查询、代码执行等），并供所有代理使用，实现了工具的集中管理和复用。
    - **稳定性**: `streamable-http` 模式相比 `stdio` 模式，避免了复杂的子进程管理和跨平台导入问题，表现更稳定，也更符合现代微服务架构思想。

---

#### **4. 结论与展望**

本次实验成功构建了一个功能完备的多代理协作系统。实验结果验证了 **LangGraph + MCP** 架构在构建复杂、模块化和可扩展的 AI Agent 系统方面的巨大潜力。

**未来可改进的方向包括**:

1. **引入循环机制**: 在 LangGraph 中增加条件边，如果审核代理认为稿件质量不达标，可以将其发回给撰写代理进行重写，形成“撰写-审核”的循环，直到质量达标。
2. **增强工具能力**: 在 MCP 服务器上集成更多样化的工具，例如代码解释器、文件读写工具等，赋予代理更强大的能力。
3. **并行执行**: 对于可以并行处理的任务（例如，针对不同子主题进行研究），可以利用 LangGraph 的并行执行能力来提升效率。